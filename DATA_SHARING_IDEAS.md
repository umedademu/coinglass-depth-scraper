# データ共有機能のアイディア

## 概要
Coinglass Scraperのユーザー間でデータを共有し、24時間365日のデータ収集を実現する協調型システムの設計案。

## 現在の仕様
- **データ保存**: SQLiteローカルDB（`btc_usdt_order_book.db`）
- **保存間隔**: 1分に1レコード
- **データ構造**: timestamp, ask_total, bid_total, price
- **保存期間**: 300日（自動削除）

## データ共有の基本コンセプト
```
ユーザーA（稼働中） → データ取得 → クラウドDB → ユーザーB（起動時に取得）
                         ↓
                    ローカルSQLite（バックアップ）
```

## クラウドサービス別の制限

### Supabase
- **無料枠**: 500MB、50,000行/月、2GB帯域幅
- **1ユーザー/月**: 43,200行（ギリギリ）
- **複数ユーザー**: 重複排除すれば同じ行数

### 代替サービス
1. **Firebase Realtime Database**
   - 1GB無料、同時接続100
   - リアルタイム同期に最適

2. **Google Sheets API**
   - 無料、制限緩い
   - 簡易的なデータ共有に便利

3. **MongoDB Atlas**
   - 512MB無料
   - より高度なクエリが可能

## 推奨実装パターン

### パターン1: 階層型データ保存
```
ローカルDB:
- 全期間: 1分単位で保存

クラウドDB:
- 直近24時間: 1分単位
- 1週間前まで: 5分単位
- 1ヶ月前まで: 15分単位
- それ以前: 1時間単位
```

### パターン2: 間引き保存
```python
# ローカル: 毎分保存
save_to_local_db(data)  # 既存処理

# クラウド: 5分ごとに保存
if datetime.now().minute % 5 == 0:
    save_to_cloud_db(data)
```
月間使用量: 8,640行（余裕あり）

### パターン3: オンデマンド同期
- 通常時: ローカルのみ保存
- 起動時: 欠損期間をクラウドから取得
- 終了時: 自分のデータをアップロード

## 実装に必要な変更

### 1. 設定ファイル追加
```json
{
  "cloud_sync": {
    "enabled": true,
    "service": "supabase",
    "api_key": "your-api-key",
    "url": "your-project-url",
    "group_id": "friends-group-001"
  }
}
```

### 2. 同期モジュール
```python
class CloudSync:
    def __init__(self, config):
        self.supabase = create_client(config['url'], config['api_key'])
    
    def upload_data(self, data):
        # 重複チェック後アップロード
        pass
    
    def download_missing_data(self, start_time, end_time):
        # 欠損期間のデータ取得
        pass
```

### 3. UIの追加要素
- 同期状態の表示
- グループ設定
- 同期ON/OFF切り替え

## セキュリティ考慮事項

1. **APIキーの管理**
   - 環境変数または暗号化設定ファイル
   - ユーザーには見せない

2. **グループ機能**
   - グループIDによるアクセス制御
   - 招待制またはパスワード保護

3. **データ検証**
   - 異常値の検出
   - タイムスタンプの整合性チェック

## メリット
- **24時間データ収集**: 誰か1人でも動いていればOK
- **データ欠損なし**: PC停止中も他ユーザーが補完
- **負荷分散**: 複数人で監視の信頼性向上
- **コスト削減**: 無料枠で十分運用可能

## デメリット・課題
- **プライバシー**: データ共有の範囲設定
- **依存性**: クラウドサービスへの依存
- **複雑性**: 同期ロジックの実装
- **帯域幅**: アップロード/ダウンロードの通信量

## 今後の拡張案

### フェーズ1: 基本実装
- Supabase統合
- 5分間隔での同期
- 起動時の欠損データ取得

### フェーズ2: 高度な機能
- リアルタイム同期
- グループ管理機能
- データ分析・統計表示

### フェーズ3: 分散型
- P2P同期オプション
- 複数クラウドサービス対応
- 自動フェイルオーバー