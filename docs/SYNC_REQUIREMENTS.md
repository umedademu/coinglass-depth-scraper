# 完全データ同期機能の要件

## 目的
複数のPCで本ツールを使用する際に、全てのPCが同じ完全なデータセットを共有できるようにする。

## 現状の問題点
- PC Aが1-12時、PC Bが11-23時に稼働しても、各PCは自分が稼働していた時間のデータしか持たない
- 中間の欠損データ（例：12-18時が欠けている）が検出・補完されない
- 結果として、PCごとに異なるデータセット・グラフになってしまう

## 必要な修正

### 1. 起動時の処理を変更
- 現在：過去24時間分のデータのみ取得
- 修正後：Supabaseの全データを取得し、ローカルDBと比較して欠損部分のみ挿入

### 2. 定期的な全データ同期
- 現在：5分ごとに自分のデータをアップロードするのみ
- 修正後：5分ごとにSupabaseから全データを取得してローカルの欠損を埋める

### 3. 欠損検出の改善
- 現在：最新データから現在時刻までの差分のみチェック
- 修正後：全期間をスキャンして中間の欠損も検出

### 4. データ取得ロジックの変更
- 現在：期間指定（例：13時から15時まで）でデータ要求
- 修正後：ローカルに存在しないタイムスタンプを個別に特定して取得

## データ統合の原則
- 同じタイムスタンプに複数のデータが存在する場合は、**最大値を採用**
- 理由：スクレイピングエラーは値を小さくする傾向があるため

## 期待される結果
- いつ、どのPCを起動しても、全てのPCが同じ完全なデータセットを持つ
- 例：PC Aが1-12時、PC Bが11-23時に稼働した場合、両方のPCが1-23時の完全なデータを共有
- 5分足以上のグラフは全PCで完全に一致する